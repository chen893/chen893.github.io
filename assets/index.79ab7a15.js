var Ze=Object.defineProperty,et=Object.defineProperties;var tt=Object.getOwnPropertyDescriptors;var N=Object.getOwnPropertySymbols;var he=Object.prototype.hasOwnProperty,pe=Object.prototype.propertyIsEnumerable;var Y=(e,t,n)=>t in e?Ze(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,m=(e,t)=>{for(var n in t||(t={}))he.call(t,n)&&Y(e,n,t[n]);if(N)for(var n of N(t))pe.call(t,n)&&Y(e,n,t[n]);return e},b=(e,t)=>et(e,tt(t));var C=(e,t)=>{var n={};for(var o in e)he.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(e!=null&&N)for(var o of N(e))t.indexOf(o)<0&&pe.call(e,o)&&(n[o]=e[o]);return n};var ge=(e,t,n)=>(Y(e,typeof t!="symbol"?t+"":t,n),n);import{n as f,B as I,j as u,a as r,D as be,T as X,S as Z,r as p,R as k,u as _,l as nt,b as w,c as v,d as ee,P as Ie,L as P,e as Fe,f as ve,F as y,g as Ce,I as F,h as q,i as U,C as rt,k as ot,m as te,o as G,M as x,p as ne,q as J,s as T,t as st,v as it,w as xe,x as j,N as ke,y as at,z as ct,A as ut,Q as dt,E as lt,G as mt,H as ht}from"./vendor.99960d9e.js";const pt=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerpolicy&&(i.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?i.credentials="include":s.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}};pt();const D=f.div`
display: flex;
align-items: center;
justify-content: ${e=>e.between?"space-between":void 0};
> * {
  margin-top: 0 !important;
  margin-bottom: ${e=>typeof e.marginBottom=="number"?e.marginBottom+"rem":0} ;
  margin-right: ${e=>typeof e.gap=="number"?e.gap+"rem":e.gap?"2rem":"0"}
}`,Be=f.div`
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;

`,gt=()=>r(Be,{children:r(Z,{size:"large"})}),Pe=({error:e})=>u(Be,{children:[r(z,{error:e}),r(be,{})]}),we=f(I)`
  padding: 0px;
`,ft=e=>e==null?void 0:e.message,z=function({error:e}){return ft(e)?r(X.Text,{type:"danger",children:e.message}):null},De=f.div`
  padding: 3.2rem;
  width: 100%;
  display: flex;
  flex-direction: column; 
`,re="__auth_provider_token__",Et=()=>window.localStorage.getItem(re),Ae=({user:e})=>(window.localStorage.setItem(re,e.token||""),e),Te="http://localhost:3001",yt=e=>fetch(`${Te}/login`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(e)}).then(async t=>t.ok?Ae(await t.json()):Promise.reject(await t.json())),bt=e=>fetch(`${Te}/register`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(e)}).then(async t=>t.ok?Ae(await t.json()):Promise.reject(await t.json())),je=async()=>{window.localStorage.removeItem(re)},It=e=>e==null||e==="",oe=e=>{const t=m({},e);return Object.keys(t).forEach(n=>{const o=t[n];It(o)&&delete t[n]}),t},Ft=e=>{p.exports.useEffect(()=>{e()},[])};function Se(e,t){const[n,o]=p.exports.useState(e);return p.exports.useEffect(()=>{const s=setTimeout(()=>o(e),t);return()=>{clearTimeout(s)}},[e,t]),n}function se(e,t=!0){const n=p.exports.useRef(document.title).current;p.exports.useEffect(()=>{document.title=e},[e]),p.exports.useEffect(()=>()=>{document.title=n},[n,t])}const vt=()=>{const e=p.exports.useRef(!1);return p.exports.useEffect(()=>(e.current=!0,()=>{e.current=!1}),[]),e},Ct=(e,t)=>{const n=Object.entries(e).filter(([o])=>t.includes(o));return Object.fromEntries(n)},xt={error:null,data:null,stat:"idle"},kt=e=>{const t=vt();return p.exports.useCallback((...n)=>t.current?e(...n):void 0,[t,e])},ie=e=>{const[t,n]=p.exports.useReducer((l,h)=>m(m({},l),h),m(m({},xt),e)),[o,s]=p.exports.useState(()=>()=>{}),i=kt(n),a=p.exports.useCallback(l=>{i({error:null,data:l,stat:"success"})},[i]),c=p.exports.useCallback(l=>{i({error:l,stat:"error",data:null})},[i]),d=p.exports.useCallback((l,h)=>{if(!l||!l.then)throw new Error("\u8BF7\u4F20\u5165 Promise \u7C7B\u578B\u6570\u636E ");return s(()=>()=>{h!=null&&h.retry&&d(h==null?void 0:h.retry(),h)}),i({stat:"loading",data:null,error:null}),l.then(g=>(a(g),g)).catch(g=>(c(g),Promise.reject(g)))},[a,c,i]);return m({isIdle:t.stat==="idle",isLoading:t.stat==="loading",isError:t.stat==="error",isSuccess:t.stat==="success",run:d,setData:a,setError:c,retry:o},t)},Bt=async()=>{let e=null;const t=Et();return t&&(e=(await Le("me",{token:t})).user),e},ae=k.createContext(void 0);ae.displayName="AuthContext";const Pt=({children:e})=>{const t=_(),{isLoading:n,isError:o,run:s,isIdle:i,data:a,setData:c,error:d}=ie();if(Ft(()=>{s(Bt())}),i||n)return r(gt,{});if(o)return r(Pe,{error:d});const l=B=>yt(B).then(O=>{c(O)}),h=B=>bt(B).then(O=>c(O)),g=()=>je().then(()=>{c(null),t.clear()});return r(ae.Provider,{value:{user:a,login:l,register:h,logout:g},children:e})},M=()=>{const e=k.useContext(ae);if(!e)throw new Error("useAuth\u5FC5\u987B\u518DAuthProvider \u4E2D\u4F7F\u7528");return e},wt="http://localhost:3001",Le=async(e,i={})=>{var a=i,{data:t,token:n,headers:o}=a,s=C(a,["data","token","headers"]);const c=m({method:"GET",headers:{Authorization:n?`Bearer ${n}`:"","Content-Type":"application/json"}},s);return c.method.toUpperCase()==="GET"?e+=`?${nt.stringify(t)}`:c.body=JSON.stringify(t||{}),window.fetch(`${wt}/${e}`,c).then(async d=>{if(d.status===401)return await je(),window.location.reload(),Promise.reject({message:"\u8BF7\u91CD\u65B0\u767B\u5F55"});const l=await d.json();return d!=null&&d.ok?l:Promise.reject(l)})},E=()=>{const{user:e}=M();return(...[t,n])=>Le(t,b(m({},n),{token:e==null?void 0:e.token}))},Oe=({fromId:e,type:t,referenceId:n,list:o})=>{const s=[...o],i=s.findIndex(d=>d.id===e);if(!n)return fe([...s],i,s.length-1);const a=s.findIndex(d=>d.id===n);return(t==="after"?fe:Dt)([...s],i,a)},Dt=(e,t,n)=>{const o=e[n],s=e.splice(t,1)[0],i=e.indexOf(o);return e.splice(i,0,s),e},fe=(e,t,n)=>{const o=e[n],s=e.splice(t,1)[0],i=e.indexOf(o);return e.splice(i+1,0,s),e},$=(e,t)=>{const n=_();return{onSuccess:()=>n.invalidateQueries(e),async onMutate(o){const s=n.getQueryData(e);return n.setQueryData(e,i=>t(o,i)),{previousItems:s}},onError(o,s,i){n.setQueryData(e,i.previousItems)}}},Q=e=>$(e,(t,n)=>(n==null?void 0:n.filter(o=>o.id!==t.id))||[]),Re=e=>$(e,(t,n)=>(n==null?void 0:n.map(o=>o.id===t.id?m(m({},o),t):o))||[]),V=e=>$(e,(t,n)=>n?[...n,t]:[]),At=e=>$(e,(t,n)=>Oe(m({list:n},t))),Tt=e=>$(e,(t,n)=>Oe(m({list:n},t)).map(s=>s.id===t.fromId?b(m({},s),{kanbanId:t.toKanbanId}):s)),Me=e=>{const t=E();return w(["projects",oe(e)],()=>t("projects",{data:e}))},$e=e=>{const t=E();return v(n=>t(`projects/${n.id}`,{method:"PATCH",data:n}),Re(e))},jt=e=>{const t=E();return v(n=>t("projects",{data:n,method:"POST"}),V(e))},St=e=>{const t=E();return v(({id:n})=>t(`projects/${n}`,{method:"DELETE"}),Q(e))},Ne=e=>{const t=E();return w(["project",{id:e}],()=>t(`projects/${e}`),{enabled:Boolean(e)})},S=e=>{const[t]=ee(),n=ce(),[o]=p.exports.useState(e);return[p.exports.useMemo(()=>Ct(Object.fromEntries(t),o),[t,o]),s=>n(s)]},ce=()=>{const[e,t]=ee();return n=>{const o=oe(m(m({},Object.fromEntries(e)),n));return t(o)}},R=function(){const[{projectCreate:e},t]=S(["projectCreate"]),[{editingProjectId:n},o]=S(["editingProjectId"]);ee();const{data:s,isLoading:i}=Ne(n),a=ce(),c=()=>{t({projectCreate:!0})},d=()=>{a({projectCreate:"",editingProjectId:""})},l=h=>o({editingProjectId:h});return{projectModalOpen:e==="true"||Boolean(n),open:c,close:d,startEdit:l,editingProject:s,isLoading:i}},Lt=()=>{const[e,t]=S(["name","personId"]);return[p.exports.useMemo(()=>b(m({},e),{personId:e.personId||void 0}),[e]),t]},W=()=>{const[e]=Lt();return["projects",e]};function Ot(){const{data:e,isLoading:t,refetch:n}=Me(),o=e==null?void 0:e.filter(c=>c.pin),{open:s}=R(),i=function(){return u(a,{children:[r(X.Text,{type:"secondary",children:"\u6536\u85CF\u9879\u76EE"}),r(P,{children:o==null?void 0:o.map(c=>r(P.Item,{children:r(P.Item.Meta,{title:c.name})},c.id))}),r(Fe,{}),r(we,{type:"link",onClick:()=>s(),children:"\u521B\u5EFA\u9879\u76EE"})]})},a=f.div`
    min-width: 15rem;
  `;return r(Ie,{placement:"bottom",onVisibleChange:()=>n(),content:i,children:r("h2",{children:"\u9879\u76EE"})})}const ue=function(e){const t=E();return w(["users",e],()=>t("users",{data:oe(e||{})}))};function Rt(){const{data:e,isLoading:t,refetch:n}=ue(),o=function(){return u(s,{children:[r(X.Text,{type:"secondary",children:"\u7EC4\u5458"}),r(P,{children:e==null?void 0:e.map(i=>r(P.Item,{children:r(P.Item.Meta,{title:i.name})},i.id))})]})},s=f.div`
    min-width: 15rem;
  `;return r(Ie,{placement:"bottom",onVisibleChange:()=>n(),content:o,children:r("h2",{children:"\u7EC4\u5458"})})}const Mt=e=>{const t=E();return w(["epics",e],()=>t("epics",{data:e}))},$t=e=>{const t=E();return _(),v(n=>t("epics",{data:n,method:"POST"}),V(e))},Nt=e=>{const t=E();return v(({id:n})=>t(`epics/${n}`,{method:"DELETE"}),Q(e))},H=e=>{const t=E(),n=b(m({},e),{name:Se(e==null?void 0:e.name,200)});return w(["tasks",n],()=>t("tasks",{data:n}))},Ut=e=>{const t=E();return w(["task",{id:e}],()=>t(`tasks/${e}`),{enabled:Boolean(e)})},Kt=e=>{const t=E();return v(n=>t(`tasks/${n.id}`,{data:n,method:"PATCH"}),Re(e))},_t=e=>{const t=E();return v(({id:n})=>t(`tasks/${n}`,{method:"DELETE"}),Q(e))},zt=e=>{const t=E();return v(n=>t("tasks/reorder",{data:n,method:"POST"}),Tt(e))},A=()=>{var n;const{pathname:e}=ve(),t=(n=e.match(/projects\/(\d+)/))==null?void 0:n[1];return Number(t)},Ue=()=>Ne(A()),de=()=>({projectId:A()}),le=()=>["kanbans",de()],L=()=>{const e=A(),[t,n]=S(["name","typeId","processorId","tagId"]);return p.exports.useMemo(()=>({projectId:e,typeId:Number(t.typeId)||void 0,processorId:Number(t.processorId)||void 0,tagId:Number(t.tagId)||void 0,name:t.name||void 0}),[e,t])},K=()=>["tasks",L()],Ke=()=>{const[{editingTaskId:e},t]=S(["editingTaskId"]),{data:n,isLoading:o}=Ut(Number(e)),s=p.exports.useCallback(a=>{console.log("test"),t({editingTaskId:a})},[t]),i=p.exports.useCallback(()=>{t({editingTaskId:""})},[t]);return{editingTask:n,editingTaskId:e,startEdit:s,close:i,isLoading:o}},_e=()=>({projectId:A()}),ze=()=>["epics",_e()],Qt=e=>{const{mutate:t,isLoading:n}=$t(ze()),[o]=y.useForm(),s=A(),i=async a=>{console.log(a),await t(b(m({},a),{projectId:s})),e.onClose()};return p.exports.useEffect(()=>{o.resetFields()},[o,e.visible]),r(Ce,{forceRender:!0,destroyOnClose:!0,width:"100%",onClose:e.onClose,visible:e.visible,children:r(Vt,{children:u(y,{onFinish:i,form:o,layout:"vertical",style:{width:"40rem",position:"absolute"},children:[r(y.Item,{name:"name",label:"\u540D\u79F0",rules:[{required:!0,message:"\u8BF7\u8F93\u5165"}],children:r(F,{placeholder:"\u8BF7\u8F93\u5165\u4EFB\u52A1 \u540D\u79F0"})}),r(I,{style:{position:"absolute",right:"0"},loading:n,type:"primary",htmlType:"submit",children:"\u63D0\u4EA4"})]})})})},Vt=f.div`
  height: 80vh;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
`;function Ht(){const{data:e}=Ue(),{data:t}=Mt(_e()),{mutate:n}=Nt(ze()),{data:o}=H({projectId:e==null?void 0:e.id}),[s,i]=p.exports.useState(!1);return u(De,{children:[u(D,{between:!0,children:[r("h1",{children:e==null?void 0:e.name}),r(I,{onClick:()=>i(!0),children:" \u65B0\u589E"})]}),r(P,{dataSource:t,itemLayout:"vertical",renderItem:a=>u(P.Item,{children:[r(P.Item.Meta,{title:u(D,{between:!0,children:[r("span",{children:a.name}),r(I,{type:"link",onClick:()=>n({id:a.id}),children:" \u5220\u9664"})]}),description:u("div",{children:[u("div",{children:["\u5F00\u59CB\u65F6\u95F4\uFF1A",q(a.start).format("YYYY-MM-DD")]}),u("div",{children:["\u7ED3\u675F\u65F6\u95F4\uFF1A",q(a.end).format("YYYY-MM-DD")]})]})}),r("div",{children:o==null?void 0:o.filter(c=>c.epicId===a.id).map(c=>r(U,{style:{marginRight:"2rem"},to:`/projects/${e==null?void 0:e.id}/kanban?editingTaskId=${c.id}`,children:c.name},c.id))})]})}),r(Qt,{onClose:()=>i(!1),visible:s})]})}const Qe=n=>{var o=n,{children:e}=o,t=C(o,["children"]);return r(rt,b(m({},t),{children:s=>k.isValidElement(e)?k.cloneElement(e,b(m({},s.droppableProps),{ref:s.innerRef,provided:s})):r("div",{})}))},Ve=k.forwardRef((o,n)=>{var s=o,{children:e}=s,t=C(s,["children"]);var i;return u("div",b(m({ref:n},t),{children:[e,(i=t.provided)==null?void 0:i.placeholder]}))}),He=n=>{var o=n,{children:e}=o,t=C(o,["children"]);return r(ot,b(m({},t),{children:s=>k.isValidElement(e)?k.cloneElement(e,b(m(m({},s.draggableProps),s.dragHandleProps),{ref:s.innerRef})):r("div",{})}))},Ye=e=>{const t=E();return w(["kanbans",e],()=>t("kanbans",{data:e}))},Yt=e=>{const t=E();return _(),v(n=>t("kanbans",{data:n,method:"POST"}),V(e))},qt=e=>{const t=E();return v(({id:n})=>t(`kanbans/${n}`,{method:"DELETE"}),Q(e))},Gt=e=>{const t=E();return v(n=>t("kanbans/reorder",{data:n,method:"POST"}),At(e))},Jt=e=>{const t=E();return v(n=>t("tasks",{data:n,method:"POST"}),V(e))},qe=()=>{const e=E();return w(["tasksType"],()=>e("taskTypes"))};var Wt="/assets/task.e5ad6607.svg",Xt="/assets/bug.5ca02341.svg";function Zt({kanbanId:e}){const[t,n]=p.exports.useState(""),{mutateAsync:o}=Jt(K()),s=A(),[i,a]=p.exports.useState(!1),c=async()=>{await o({name:t,kanbanId:e,projectId:s}),n(""),a(!1)},d=()=>a(l=>!l);return p.exports.useEffect(()=>{i||n("")},[i]),i?r(te,{children:r(F,{onBlur:d,placeholder:"\u9700\u8981\u505A\u4E9B\u4EC0\u4E48",autoFocus:!0,onPressEnter:c,value:t,onChange:l=>n(l.target.value)})}):r("div",{onClick:d,children:"+\u521B\u5EFA\u4E8B\u52A1"})}const en=({name:e,keyword:t})=>{if(!t)return r(G,{children:e});const n=e.split(t);return r(G,{children:n.map((o,s)=>u("span",{children:[o,s===n.length-1?null:r("span",{style:{color:"#257AFD"},children:t})]},s))})},tn=({id:e})=>{const{data:t}=qe(),n=t==null?void 0:t.find(o=>o.id===e);return n!=null&&n.name?r("img",{alt:"task-icon",src:n.name==="task"?Wt:Xt}):null},nn=({task:e})=>{const{startEdit:t}=Ke(),{name:n}=L();return u(te,{onClick:()=>{t(e.id)},style:{marginBottom:"0.5rem",cursor:"pointer "},children:[u("p",{children:[" ",r(en,{name:e.name,keyword:n||""})]}),r(tn,{id:e.typeId})]},e.id)},rn=k.forwardRef((o,n)=>{var s=o,{kanban:e}=s,t=C(s,["kanban"]);const{data:i}=H(L()),a=i==null?void 0:i.filter(c=>c.kanbanId===e.id);return u(Ge,b(m({},t),{ref:n,children:[u(D,{between:!0,children:[r("h3",{children:e.name}),r(on,{kanban:e},e.id)]}),u(sn,{children:[r(Qe,{type:"ROW",direction:"vertical",droppableId:String(e.id),children:r(Ve,{style:{minHeight:"1rem"},children:a==null?void 0:a.map((c,d)=>r(He,{index:d,draggableId:"task"+c.id,children:r("div",{children:r(nn,{task:c},c.id)})},c.id))})}),r(Zt,{kanbanId:e.id})]})]}))}),on=({kanban:e})=>{const{mutateAsync:t}=qt(le()),n=()=>{J.confirm({okText:"\u786E\u5B9A",cancelText:"\u53D6\u6D88",title:"\u786E\u5B9A\u5220\u9664\u770B\u677F\u5417",onOk(){return t({id:e.id})}})},o=r(x,{children:r(x.Item,{children:r(I,{onClick:n,type:"link",children:"\u5220\u9664"})})});return r(ne,{overlay:o,children:r(I,{type:"link",children:"..."})})},Ge=f.div`
  min-width: 27rem;
  border-radius: 6px;
  background-color: rgb(244, 245, 247);
  display: flex;
  flex-direction: column;
  padding: 0.7rem 0.7rem 1rem;
  margin-right: 1.5rem;
`,sn=f.div`
  overflow: scroll;
  /* overflow: hidden; */
  /* flex: 1; */
  /* height: 50%; */
  ::-webkit-scrollbar {
    display: none;
  }
`,an=()=>{const[e,t]=p.exports.useState(""),n=A(),{mutateAsync:o}=Yt(le());return r(Ge,{children:r(F,{size:"large",placeholder:"\u65B0\u5EFA\u770B\u677F\u540D\u79F0",onPressEnter:async()=>{await o({name:e,projectId:n}),t("")},value:e,onChange:i=>t(i.target.value)})})},Je=e=>{const a=e,{value:t,onChange:n,defaultOptionName:o,options:s}=a,i=C(a,["value","onChange","defaultOptionName","options"]);return u(T,b(m({value:s!=null&&s.length?Ee(t):0,onChange:c=>n==null?void 0:n(Ee(c)||void 0)},i),{children:[o?r(T.Option,{value:0,children:o}):null,s==null?void 0:s.map(c=>r(T.Option,{value:c.id,children:c.name},c.id))]}))},Ee=e=>isNaN(Number(e))?0:Number(e),We=e=>{const{data:t}=qe();return r(Je,m({options:t||[]},e))},me=e=>{const{data:t}=ue();return r(Je,m({options:t||[]},e))},cn=()=>{const e=L(),t=ce(),n=()=>{t({typeId:void 0,processorId:void 0,tagId:void 0,name:void 0})};return u(D,{marginBottom:2,gap:!0,children:[r(F,{style:{width:"20rem"},placeholder:"\u9879\u76EE\u540D",value:e.name,onChange:o=>{t({name:o.target.value})}}),r(me,{defaultOptionName:"\u7ECF\u529E\u4EBA",value:e.processorId,onChange:o=>{t({processorId:o})}}),r(We,{defaultOptionName:"\u7C7B\u578B",value:e.typeId,onChange:o=>t({typeId:o})}),r(I,{onClick:()=>n(),children:"\u6E05\u9664\u7B5B\u9009\u5668"})]})},un={labelCol:{span:8},wrapperCol:{span:16}};function dn(){const[e]=st.useForm(),{editingTaskId:t,editingTask:n,close:o}=Ke(),{mutateAsync:s,isLoading:i}=Kt(K()),a=()=>{o(),e.resetFields()},c=async()=>{await s(m(m({},n),e.getFieldsValue())),o()},{mutateAsync:d}=_t(K());p.exports.useEffect(()=>{e.setFieldsValue(n)},[e,n]);const l=()=>{o(),J.confirm({title:"\u786E\u5B9A\u5220\u9664\u4EFB\u52A1\u5417",okText:"\u786E\u5B9A",cancelText:"\u53D6\u6D88",onOk:()=>d({id:Number(t)})})};return r(J,{forceRender:!0,onCancel:a,onOk:c,okText:"\u786E\u5B9A",cancelText:"\u53D6\u6D88",confirmLoading:i,title:"\u7F16\u8F91\u4EFB\u52A1",visible:!!t,children:u(y,b(m({form:e},un),{initialValues:n,children:[r(y.Item,{name:"name",label:"\u4EFB\u52A1\u540D",children:r(F,{})}),r(y.Item,{label:"\u7ECF\u529E\u4EBA",name:"processorId",children:r(me,{defaultOptionName:"\u7ECF\u529E\u4EBA"})}),r(y.Item,{label:"\u7C7B\u578B",name:"typeId",children:r(We,{})}),r("div",{style:{textAlign:"right"},children:r(I,{type:"link",onClick:l,children:"\u5220\u9664"})})]}))})}function ln(){se("\u770B\u677F\u5217\u8868");const{data:e}=Ue(),{data:t,isLoading:n}=Ye(de()),{isLoading:o}=H(L()),s=o||n,i=mn();return r(it,{onDragEnd:i,children:u(De,{children:[u("h1",{children:[e==null?void 0:e.name,"\u770B\u677F"]}),r(cn,{}),s?r(Z,{size:"large"}):u(hn,{children:[r(Qe,{type:"COLUMN",direction:"horizontal",droppableId:"kanban",children:r(Ve,{style:{display:"flex"},children:t==null?void 0:t.map((a,c)=>r(He,{draggableId:"kanban"+a.id,index:c,children:r(rn,{kanban:a},a.id)},a.id))})}),r(an,{})]}),r(dn,{})]})})}const mn=()=>{const{data:e}=Ye(de()),{mutate:t}=Gt(le()),{data:n=[]}=H(L()),{mutate:o}=zt(K());return p.exports.useCallback(({source:s,destination:i,type:a})=>{if(console.log(s,i,a),!!i){if(a==="COLUMN"){const c=e==null?void 0:e[s.index].id,d=e==null?void 0:e[i.index].id;if(!c||!d||c===d)return;const l=i.index>s.index?"after":"before";t({fromId:c,referenceId:d,type:l})}if(a==="ROW"){const c=+s.droppableId,d=+i.droppableId,l=n.filter(g=>g.kanbanId===c)[s.index],h=n.filter(g=>g.kanbanId===d)[i.index];if((l==null?void 0:l.id)===(h==null?void 0:h.id)&&c===d)return;o({fromId:l==null?void 0:l.id,referenceId:h==null?void 0:h.id,fromKanbanId:c,toKanbanId:d,type:c===d&&i.index>s.index?"after":"before"})}}},[e,t,n,o])},hn=f.div`
  display: flex;
  /* overflow: scroll; */
  flex: 1;
  overflow-x: scroll;

`,pn=()=>{const e=ve().pathname.split("/");return e[e.length-1]};function gn(){const e=pn();return u(yn,{children:[r(fn,{children:u(x,{mode:"inline",selectedKeys:[e],children:[r(x.Item,{children:r(U,{to:"kanban",children:"\u770B\u677F"})},"kanban"),r(x.Item,{children:r(U,{to:"epic",children:"\u4EFB\u52A1\u7EC4"})},"epic")]})}),r(En,{children:u(xe,{children:[r(j,{path:"/kanban",element:r(ln,{})}),r(j,{path:"/epic",element:r(Ht,{})}),r(j,{path:"/*",element:r(ke,{to:"kanban",replace:!0})})]})})]})}const fn=f.aside`
  background-color: rgb(244, 245, 247);
  display: flex;
`,En=f.div`
  box-shadow: -5px 0 5px -5px rgba(0, 0, 0, 0.1);
  display: flex;
  overflow: hidden;
`,yn=f.div`
  display: grid;
  grid-template-columns: 16rem 1fr;
  width: 100%;
`,ye=o=>{var s=o,{checked:e,onCheckedChange:t}=s,n=C(s,["checked","onCheckedChange"]);return r(at,m({count:1,value:e?1:0,onChange:i=>t==null?void 0:t(!!i)},n))};function bn(n){var o=n,{users:e}=o,t=C(o,["users"]);const{mutate:s}=$e(W()),{startEdit:i}=R(),a=h=>g=>{s({id:h,pin:g})},{mutate:c}=St(W()),d=h=>()=>i(h),l=h=>()=>c(String(h));return R(),r(ct,b(m({},t),{columns:[{title:r(ye,{checked:!0,disabled:!0}),render(h,g){return r(ye,{checked:g.pin,onCheckedChange:a(g.id)})}},{title:"\u540D\u79F0",sorter:(h,g)=>h.name.localeCompare(g.name),render(h,g){return r(U,{to:String(g.id),children:g.name})}},{title:"\u90E8\u95E8",dataIndex:"organization"},{title:"\u521B\u5EFA\u65F6\u95F4",render(h,g){return r("span",{children:g.created?q(g.created).format("YYYY-MM-DD"):"\u65E0"})}},{title:"\u8D1F\u8D23\u4EBA",render(h,g){var B;return r("span",{children:((B=e.find(O=>O.id===g.personId))==null?void 0:B.name)||"\u672A\u77E5"})}},{render(h,g){return r(ne,{overlay:u(x,{children:[r(x.Item,{onClick:d(g.id),children:"\u7F16\u8F91"},"edit"),r(x.Item,{onClick:l(g.id),children:"\u5220\u9664"},"delete")]}),children:r(we,{type:"link",children:"..."})})}}]}))}function In({param:e,setParam:t,users:n}){E();let[o,s]=p.exports.useState("");p.exports.useEffect(()=>{var a;n.length>0&&s((a=n.find(c=>c.id==e.personId))==null?void 0:a.name)},[n]);const i=p.exports.useMemo(()=>function(){return u(T,{labelInValue:!0,defaultValue:{value:o||"\u8D1F\u8D23\u4EBA",key:e.personId},onChange:a=>{t(b(m({},e),{personId:a.key}))},children:[r(T.Option,{value:"",children:"\u8D1F\u8D23\u4EBA"}),n.map(a=>r(T.Option,{value:a.name,children:a.name},a.id))]})},[o]);return u(Fn,{action:"",children:[r(vn,{placeholder:"\u9879\u76EE\u540D\u79F0",type:"text",size:"middle",value:e.name,onChange:a=>t(b(m({},e),{name:a.target.value}))}),r(i,{})]})}const Fn=f(y)`
  // display: flex;
  // justify-content: space-between;
  // margin-left: 1vw;
  // margin-right: 1vw;
`,vn=f(F)`
  width: 30vw;
  margin-right: 2vw; 
`;function Cn(){E(),se("\u9879\u76EE\u5217\u8868");const[e,t]=S(["name","personId"]),n=Se(e,200),{isLoading:o,error:s,data:i}=Me(n),{data:a}=ue(),{open:c}=R();return u(xn,{children:[u(D,{between:!0,children:[r("h1",{children:"\u9879\u76EE\u5217\u8868"}),r(I,{onClick:()=>{c()},children:"\u521B\u5EFA\u9879\u76EE"})]}),r(z,{error:s}),r(In,{param:e,setParam:t,users:a||[]}),r(bn,{users:a||[],dataSource:i||void 0,loading:o})]})}const xn=f.div`
  padding:0 3rem 0 3rem;
  flex: 1
`,kn=()=>{const{projectModalOpen:e,close:t,editingProject:n,isLoading:o}=R(),s=n?$e:jt,{mutateAsync:i,error:a,isLoading:c}=s(W()),[d]=y.useForm(),l=B=>{console.log("Received values of form: ",B),i(m(m({},n),B)).then(()=>{d.resetFields(),t()})},h=()=>{d.resetFields(),t()},g=n?"\u7F16\u8F91\u9879\u76EE":"\u521B\u5EFA\u9879\u76EE";return p.exports.useEffect(()=>{d.setFieldsValue(n)},[n,d]),r(Ce,{forceRender:!0,onClose:h,visible:e,width:"100%",children:r(Bn,{children:o?r(Z,{size:"large"}):u(G,{children:[r("h1",{children:g}),r(z,{error:a}),u(y,{form:d,layout:"vertical",style:{width:"40rem"},onFinish:l,children:[r(y.Item,{label:"\u540D\u79F0",name:"name",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u9879\u76EE\u540D"}],children:r(F,{placeholder:"\u8BF7\u8F93\u5165\u9879\u76EE\u540D\u79F0"})}),r(y.Item,{label:"\u90E8\u95E8",name:"organization",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u90E8\u95E8\u540D"}],children:r(F,{placeholder:"\u8BF7\u8F93\u5165\u90E8\u95E8\u540D"})}),r(y.Item,{label:"\u8D1F\u8D23\u4EBA",name:"personId",children:r(me,{defaultOptionName:"\u8D1F\u8D23\u4EBA"})}),r(y.Item,{style:{textAlign:"right"},children:r(I,{loading:c,type:"primary",htmlType:"submit",children:"\u63D0\u4EA4"})})]})]})})})},Bn=f.div`
  height: 80vh;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
`;function Pn(){return r(ut,{children:u(An,{children:[r(wn,{}),r(Ln,{children:u(xe,{children:[r(j,{path:"/projects",element:r(Cn,{})}),r(j,{path:"/projects/:projectId/*",element:r(gn,{})}),r(j,{path:"*",element:r(ke,{to:"projects"})})]})}),r(kn,{})]})})}const wn=()=>u(Tn,{between:!0,children:[u(jn,{gap:!0,children:[r(I,{type:"link",onClick:()=>{window.location.href=window.location.origin},children:"\u4E3B\u9875"}),r(Ot,{}),r(Rt,{})]}),r(Sn,{children:r(Dn,{})})]}),Dn=()=>{const{logout:e,user:t}=M();return r(ne,{overlay:r(x,{children:r(x.Item,{children:r(I,{type:"link",onClick:e,children:"\u9000\u51FA"})})}),children:u(I,{type:"link",onClick:n=>n.preventDefault(),children:["Hi, ",t==null?void 0:t.name]})})},An=f.div`
  display: grid;
  grid-template-rows: 6rem 1fr;
  height: 100vh;
`,Tn=f(D)`
  padding: 0 3rem 0 3rem;
  box-shadow: 0 0 5px 0 rgba(0, 0, 0, 0.1);
  z-index: 1;
`,jn=f(D)``,Sn=f.div``,Ln=f.main`
  display: flex;
  overflow: hidden;
`;function On({onError:e}){const{login:t,user:n}=M(),{run:o,isLoading:s}=ie();return u(y,{onFinish:a=>{e(null),o(t(a).catch(e))},children:[r(y.Item,{name:"username",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D"}],children:r(F,{placeholder:"\u7528\u6237\u540D",type:"text",id:"username"})}),r(y.Item,{name:"password",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D"}],children:r(F,{placeholder:"\u5BC6\u7801",id:"password"})}),r(Xe,{type:"primary",htmlType:"submit",loading:s,children:" \u767B\u5F55"})]})}function Rn({onError:e}){const{run:t,isLoading:n}=ie(),{register:o,user:s}=M();return u(y,{onFinish:d=>{var l=d,{cpassword:a}=l,c=C(l,["cpassword"]);if(e(null),a!==c.password){e(new Error("\u4E24\u6B21\u8F93\u5165\u7684\u5BC6\u7801\u4E0D\u4E00\u81F4"));return}t(o(c).catch(h=>{e(h)}))},children:[r(y.Item,{name:"username",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D"}],children:r(F,{placeholder:"\u7528\u6237\u540D",type:"text",id:"username"})}),r(y.Item,{name:"password",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801"}],children:r(F,{placeholder:"\u5BC6\u7801",id:"password"})}),r(y.Item,{name:"cpassword",rules:[{required:!0,message:"\u8BF7\u786E\u8BA4\u5BC6\u7801"}],children:r(F,{placeholder:"\u5BC6\u7801",id:"cpassword"})}),r(Xe,{type:"primary",htmlType:"submit",loading:n,children:" \u6CE8\u518C"})]})}var Mn="/assets/logo.aa35c111.svg",$n="/assets/left.54ddf911.svg",Nn="/assets/right.47245c1a.svg";function Un(){const[e,t]=p.exports.useState(!1),[n,o]=p.exports.useState(null);return se("\u8BF7\u767B\u5F55\u6CE8\u518C\u4EE5\u7EE7\u7EED"),u(Vn,{children:[r(zn,{}),r(_n,{}),u(Qn,{children:[r(Kn,{children:e?"\u8BF7\u6CE8\u518C":"\u8BF7\u767B\u5F55"}),r(z,{error:n}),e?r(Rn,{onError:o}):r(On,{onError:o}),r(Fe,{}),r(I,{type:"link",onClick:()=>t(!e),children:e?"\u5DF2\u7ECF\u6709\u8D26\u53F7\u4E86\uFF1F\u76F4\u63A5\u767B\u5F55":"\u6CA1\u6709\u8D26\u53F7\uFF1F\u6CE8\u518C\u65B0\u8D26\u53F7"})]})]})}const Xe=f(I)`
  width: 100%;
`,Kn=f.h2`
  margin-bottom: 2.4rem;
  color: rgb(94, 108, 132);
`,_n=f.div`
  position: absolute;
  width: 100%;
  height: 100%;
  background-repeat: no-repeat;
  background-attachment: fixed;
  background-position: left bottom, right bottom;
  background-size: calc(((100vw - 40rem) / 2) - 3.2rem),
    calc(((100vw - 40rem) / 2) - 3.2rem), cover;
  background-image: url(${$n}), url(${Nn});
`,zn=f.header`
  background: url(${Mn}) no-repeat center;
  padding: 5rem 0;
  background-size: 8rem;
  width: 100%;
`,Qn=f(te)`
  width: 40rem;
  min-height: 56rem;
  padding: 3.2rem 4rem;
  border-radius: 0.3rem;
  box-sizing: border-box;
  box-shadow: rgba(0, 0, 0, 0.1) 0 0 10px;
  text-align: center;
`,Vn=f.div`
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 100vh;
`;class Hn extends k.Component{constructor(){super(...arguments);ge(this,"state",{error:null})}static getDerivedStateFromError(t){return{error:t}}render(){const{error:t}=this.state,{fallbackRender:n,children:o}=this.props;return t?n({error:t}):o}}function Yn(){const{user:e}=M();return document.addEventListener("error",t=>{alert(t)}),r("div",{className:"App",children:r(Hn,{fallbackRender:Pe,children:e?r(Pn,{}):r(Un,{})})})}function qn({children:e}){return r(dt,{client:new lt,children:r(Pt,{children:e})})}mt(()=>{ht.render(r(k.StrictMode,{children:u(qn,{children:[r(be,{}),r(Yn,{})]})}),document.getElementById("root"))});
